<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="stylesheet" href="style.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
<script type="module" src="firebase.js"></script>
<style>
body { font-family:Arial; padding:20px; background:#f0f4f8; }
.card { background:white; padding:20px; margin:15px 0; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
button { background:#007bff; color:white; border:none; padding:10px; margin:5px; cursor:pointer; }
button:hover { background:#0056b3; }
</style>
</head>
<body>
<h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h2>

<div id="usersContainer"></div>

<script type="module">
import { db } from './firebase.js';
import { collection, getDocs, doc, updateDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

async function loadUsers(){
  const container = document.getElementById("usersContainer");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  const usersSnap = await getDocs(collection(db,"users"));
  container.innerHTML = "";

  for(const userDoc of usersSnap.docs){
    const userData = userDoc.data();
    const userDiv = document.createElement("div");
    userDiv.className = "card";
    userDiv.innerHTML = `<b>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${userData.email}</b><br>`;

    // Ø¬Ù„Ø¨ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const adsSnap = await getDocs(collection(db,"ads"));
    adsSnap.forEach(ad=>{
      const data = ad.data();
      if(data.userId === userDoc.id){
        const adDiv = document.createElement("div");
        adDiv.className = "card";
        adDiv.innerHTML = `<b>${data.featured?'ğŸŒŸ Ù…Ù…ÙŠØ²':''}</b> ${data.type}<br>${data.desc}<br>
          <button onclick="toggleFeature('${ad.id}', ${!data.featured})">ØªØºÙŠÙŠØ± Ù…Ù…ÙŠØ²</button>
          <button onclick="deleteAd('${ad.id}')">Ø­Ø°Ù</button>`;
        userDiv.appendChild(adDiv);
      }
    });

    container.appendChild(userDiv);
  }
}

window.toggleFeature = async (adId, state) => {
  await updateDoc(doc(db,"ads",adId), { featured: state });
  loadUsers();
};

window.deleteAd = async (adId) => {
  await deleteDoc(doc(db,"ads",adId));
  loadUsers();
};

loadUsers();
</script>
</body>
</html>